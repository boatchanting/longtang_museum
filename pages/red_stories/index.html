<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
  <title>故事</title>
  <!-- 代码学习自 山羊の前端小窝，做了微调 -->
  <!-- 尽量提示浏览器横屏显示（并非所有浏览器都支持）-->
  <meta name="screen-orientation" content="landscape" />
  <meta name="x5-orientation" content="landscape" />

  <link rel="stylesheet" href="https://static.fontawesome.com/css/fontawesome-app.css" />
  <link rel="stylesheet" href="./font/iconfont.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400&display=swap" />

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Source Sans Pro", sans-serif;
    }

    html,
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-size: cover;
      overflow: hidden;
      transition: background-image 0.7s ease-in-out;
    }

    .shell {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      background: rgba(99, 99, 99, 0.8);
    }

    .shell_body {
      width: 100%;
      padding: 20px 0;
    }

    .shell_slider {
      position: relative;
      transition: transform 1s ease-in-out;
      will-change: transform;
    }

    .item {
      position: relative;
      float: left;
      margin: 0 20px;
    }

    .frame {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 1s ease-in-out;
      transform-style: preserve-3d;
    }

    .frame::after {
      content: "";
      position: absolute;
      bottom: -16%;
      width: 100%;
      height: 60px;
      background: #ffffff1c;
      box-shadow: 0 0 15px 5px #ffffff1c;
      transform: rotateX(90deg) translate3d(0, -20px, 0);
    }

    .box {
      position: absolute;
      inset: 0;
      border: 4px solid #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      perspective: 1000px;
      transform-style: preserve-3d;
    }

    .box h1,
    .box span {
      color: #fff;
      transform: translateZ(20px);
    }

    .box h1 {
      font-size: 100px;
      text-shadow: 0 0 30px #1f05b4;
    }

    .box span {
      position: absolute;
      bottom: 20px;
      padding: 0 25px;
      text-shadow: 0 0 10px #1f05b4;
    }

    .front,
    .left,
    .right {
      background-size: cover;
      box-shadow: 0 0 50px #ffffff;
    }

    .right,
    .left {
      top: 0;
      width: 60px;
      backface-visibility: hidden;
    }

    .left {
      left: 0;
      border-left-width: 5px;
      transform: translate3d(1px, 0, -60px) rotateY(-90deg);
      transform-origin: 0%;
    }

    .right {
      right: 0;
      border-right-width: 5px;
      transform: translate3d(-1px, 0, -60px) rotateY(90deg);
      transform-origin: 100%;
    }
  </style>
</head>

<body>
  <div class="shell">
    <div class="shell_body">
      <div class="shell_slider">
        <!-- 根据需要增删 item，这里示例 9 张 -->
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2014</h1><span>-In 2014 I reached the age of 13-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2015</h1><span>-In 2015 I reached the age of 14-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2016</h1><span>-In 2016 I reached the age of 15-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2017</h1><span>-In 2017 I reached the age of 16-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2018</h1><span>-In 2018 I reached the age of 17-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2019</h1><span>-In 2019 I reached the age of 18-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2020</h1><span>-In 2020 I reached the age of 19-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2021</h1><span>-In 2021 I reached the age of 20-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
        <div class="item">
          <div class="frame">
            <div class="box front"><h1>2022</h1><span>-In 2022 I reached the age of 21-</span></div>
            <div class="box left"></div>
            <div class="box right"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  /* === 轮播初始化 === */
  document.querySelectorAll(".item").forEach((item, idx) => {
    ["front", "left", "right"].forEach(cls => {
      item.querySelector("." + cls).style.backgroundImage =
        "url(./img/" + String(idx + 1).padStart(2, "0") + ".jpg)";
    });
  });

  (function () {
    "use strict";

    const shell   = document.querySelector(".shell");
    const slider  = shell.querySelector(".shell_slider");
    const items   = [...shell.querySelectorAll(".item")];   // 真正的 n 项
    const N       = items.length;

    /* --- 1. 复制首尾，形成 N+2 结构 --- */
    const firstClone = items[0].cloneNode(true);
    const lastClone  = items[N - 1].cloneNode(true);
    slider.appendChild(firstClone);
    slider.insertBefore(lastClone, items[0]);
    const allItems = [...slider.querySelectorAll(".item")]; // N+2

    /* --- 2. 变量 --- */
    let width, height, totalWidth, margin = 20;
    let realIndex = 0;          // 0 ~ N-1
    let currIndex = 1;          // 1 ~ N  (因为 0 是 lastClone)

    /* --- 3. 大小计算 --- */
    function resize() {
      width      = Math.max(window.innerWidth * 0.2, 275);
      height     = window.innerHeight * 0.5;
      totalWidth = width * allItems.length;
      slider.style.width = totalWidth + "px";

      allItems.forEach(it => {
        it.style.width  = width - margin * 2 + "px";
        it.style.height = height + "px";
      });

      jumpTo(currIndex, false);     // 立即定位
    }

    /* --- 4. 实际移动 --- */
    function jumpTo(index, animate = true) {
      slider.style.transition = animate ? "transform 1s ease-in-out" : "none";
      slider.style.transform  =
        "translate3d(" +
        ((index * -width) + width / 2 + window.innerWidth / 2) +
        "px, 0, 0)";

      currIndex = index;

      /* 更新 active 和背景 */
      allItems.forEach((item, i) => {
        const box = item.querySelector(".frame");
        if (i === index) {
          item.classList.add("item--active");
          box.style.transform = "perspective(1200px)";
        } else {
          item.classList.remove("item--active");
          box.style.transform =
            "perspective(1200px) rotateY(" + (i < index ? 40 : -40) + "deg)";
        }
      });
      const trueItem =
        allItems[index === 0 ? N : index === N + 1 ? 1 : index];
      document.body.style.backgroundImage =
        trueItem.querySelector(".front").style.backgroundImage;
    }

    /* --- 5. 动画结束：若落在克隆节点立即跳回 --- */
    slider.addEventListener("transitionend", () => {
      if (currIndex === 0)        jumpTo(N, false);   // 跳到真尾
      else if (currIndex === N + 1) jumpTo(1, false); // 跳到真头
    });

    /* --- 6. 手势滑动 --- */
    let startX = 0, diffX = 0, threshold = 50;
    slider.addEventListener("touchstart", e => (startX = e.touches[0].clientX), {passive:true});
    slider.addEventListener("touchmove",  e => (diffX = e.touches[0].clientX - startX), {passive:true});
    slider.addEventListener("touchend", () => {
      if (Math.abs(diffX) > threshold) {
        jumpTo(diffX > 0 ? currIndex - 1 : currIndex + 1, true);
      }
      diffX = 0;
    });

    window.addEventListener("resize", resize);
    window.addEventListener("orientationchange", resize);

    /* --- 7. 初始化 --- */
    resize();
    jumpTo(5, false);   // 内容上的第一张（currIndex=1, 对应真实索引0）
  })();
</script>

</body>
</html>